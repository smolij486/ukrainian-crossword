<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∞—Å–∏—á–Ω—ñ –ü—Ä–∞–≤–∏–ª–∞: –°—Ç–≤–æ—Ä–∏ –°–≤–æ—é –î–æ—Å–∫–æ–Ω–∞–ª—ñ—Å—Ç—å!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8; /* Light neutral background */
            color: #4B4B4B; /* Dark grey text */
        }
        .game-card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.08), 0 5px 10px -5px rgba(0, 0, 0, 0.03);
            padding: 2rem;
            text-align: center;
        }
        .btn-primary {
            background-color: #6366F1; /* Indigo */
            color: white;
            font-weight: 600;
            padding: 0.75rem 2rem;
            border-radius: 0.75rem;
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #4F46E5; /* Darker indigo */
            transform: translateY(-2px);
        }
        .answer-option {
            background-color: #F3F4F6; /* Light grey */
            color: #374151; /* Darker grey text */
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            text-align: left;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out, border-color 0.2s ease-in-out;
            border: 2px solid transparent;
            cursor: pointer;
        }
        .answer-option:hover {
            background-color: #E5E7EB;
            transform: translateY(-1px);
        }
        .answer-option.selected {
            border-color: #818CF8; /* Light indigo ring */
            background-color: #EEF2FF; /* Lighter indigo background */
        }
        .answer-option.correct {
            background-color: #D1FAE5; /* Light green */
            border-color: #10B981; /* Green */
            color: #065F46; /* Dark green text */
        }
        .answer-option.incorrect {
            background-color: #FEE2E2; /* Light red */
            border-color: #EF4444; /* Red */
            color: #991B1B; /* Dark red text */
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        .message-box {
            background-color: #FEF2F2; /* Light red for feedback */
            border: 1px solid #FCA5A5; /* Red border */
            color: #DC2626; /* Dark red text */
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1.5rem;
            text-align: center;
        }
        .message-box.correct {
            background-color: #D1FAE5; /* Light green for correct feedback */
            border-color: #10B981;
            color: #065F46;
        }
        .llm-explanation-box {
            background-color: #ECFDF5; /* Light emerald for explanation */
            border: 1px solid #A7F3D0; /* Emerald border */
            color: #065F46; /* Dark emerald text */
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1.5rem;
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4 sm:p-6 lg:p-8">

    <div id="game-app" class="w-full max-w-2xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-bold text-indigo-700 leading-tight">–ö–ª–∞—Å–∏—á–Ω—ñ –ü—Ä–∞–≤–∏–ª–∞: –°—Ç–≤–æ—Ä–∏ –°–≤–æ—é –î–æ—Å–∫–æ–Ω–∞–ª—ñ—Å—Ç—å! üìè</h1>
            <p class="text-lg text-stone-600 mt-2">–ó–∞—Å—Ç–æ—Å—É–π –ø—Ä–∏–Ω—Ü–∏–ø–∏ –ö–ª–∞—Å–∏—Ü–∏–∑–º—É –Ω–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ!</p>
        </header>

        <main id="game-content">
            <section id="intro-screen" class="game-card p-8 sm:p-10">
                <h2 class="text-2xl sm:text-3xl font-bold text-stone-800 mb-6">–ü—Ä–∏–≤—ñ—Ç, –º–∞–π–±—É—Ç–Ω—ñ–π –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–µ –î–æ—Å–∫–æ–Ω–∞–ª–æ—Å—Ç—ñ!</h2>
                <p class="text-stone-700 mb-8 leading-relaxed">
                    –ö–ª–∞—Å–∏—Ü–∏–∑–º ‚Äì —Ü–µ –ø—Ä–æ –ø–æ—Ä—è–¥–æ–∫, –ª–æ–≥—ñ–∫—É —Ç–∞ —ñ–¥–µ–∞–ª—å–Ω—ñ —Ñ–æ—Ä–º–∏. –ì–æ—Ç–æ–≤–∏–π –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ü—ñ –ø—Ä–∞–≤–∏–ª–∞? –£—è–≤–∏ —Å–µ–±–µ –ø–∏—Å—å–º–µ–Ω–Ω–∏–∫–æ–º, –∞—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–æ–º —á–∏ —Ö—É–¥–æ–∂–Ω–∏–∫–æ–º –µ–ø–æ—Ö–∏ –ö–ª–∞—Å–∏—Ü–∏–∑–º—É —ñ —Å–ø—Ä–æ–±—É–π –æ–±—Ä–∞—Ç–∏ –Ω–∞–π–¥–æ—Å–∫–æ–Ω–∞–ª—ñ—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç!
                </p>
                <button id="start-game-btn" class="btn-primary w-full">–ü–æ—á–∞—Ç–∏ –≥—Ä—É!</button>
            </section>

            <section id="quiz-screen" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <p id="question-count" class="text-stone-600 font-medium">–ü–∏—Ç–∞–Ω–Ω—è 1/5</p>
                    <p id="score-display" class="text-emerald-600 font-bold text-xl">‚ú® 0</p>
                </div>
                <div class="w-full bg-stone-200 rounded-full h-2.5 mb-6">
                    <div id="progress-bar-fill" class="bg-indigo-500 h-2.5 rounded-full progress-bar-fill" style="width: 0%"></div>
                </div>

                <div class="game-card p-6 sm:p-8">
                    <h3 id="question-text" class="text-xl sm:text-2xl font-bold text-stone-800 text-center mb-8 leading-normal">
                        "–í–∏ –ø–∏—à–µ—Ç–µ –ø'—î—Å—É. –Ø–∫–∏–π —Å—é–∂–µ—Ç –±—É–¥–µ –Ω–∞–π–±—ñ–ª—å—à '–∫–ª–∞—Å–∏—á–Ω–∏–º'?"
                    </h3>
                    <div id="answers-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Answer buttons will be injected here by JS -->
                    </div>
                </div>
                
                <div id="feedback-message" class="message-box hidden"></div>
                <div id="llm-explanation" class="llm-explanation-box hidden"></div>
                <button id="next-question-btn" class="btn-primary w-full mt-8 hidden">–ù–∞—Å—Ç—É–ø–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è &rarr;</button>
            </section>

            <section id="results-screen" class="hidden game-card p-8 sm:p-10">
                <h2 class="text-3xl sm:text-4xl font-bold text-indigo-700 mb-4">–¢–≤–æ—ó —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏! üéâ</h2>
                <p id="final-score" class="text-5xl font-extrabold text-emerald-600 my-8"></p>
                <p id="result-message" class="text-lg text-stone-700 mb-8 leading-relaxed">
                    –î—è–∫—É—é –∑–∞ –≥—Ä—É! –°–ø–æ–¥—ñ–≤–∞—é—Å—è, —Ç–∏ –≤—ñ–¥—á—É–≤ –ª–æ–≥—ñ–∫—É —Ç–∞ –≥–∞—Ä–º–æ–Ω—ñ—é –ö–ª–∞—Å–∏—Ü–∏–∑–º—É!
                </p>
                <button id="restart-game-btn" class="btn-primary">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑!</button>
            </section>
        </main>

        <footer class="text-center mt-12 text-stone-500 text-sm">
            <p>&copy; 2025 –í–∞—à –±–ª–æ–≥ "–°–ª–æ–≤–æ –Ω–∞ –¥–æ–ª–æ–Ω—ñ". –ù–∞—Ç—Ö–Ω–µ–Ω–æ –¥–æ—Å–∫–æ–Ω–∞–ª—ñ—Å—Ç—é –ö–ª–∞—Å–∏—Ü–∏–∑–º—É.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const questions = [
                {
                    scenario: "–í–∏ –ø–∏—à–µ—Ç–µ –ø'—î—Å—É. –Ø–∫–∏–π —Å—é–∂–µ—Ç –±—É–¥–µ –Ω–∞–π–±—ñ–ª—å—à '–∫–ª–∞—Å–∏—á–Ω–∏–º'?",
                    answers: [
                        { text: "–Ü—Å—Ç–æ—Ä—ñ—è –ø—Ä–æ –∑–≤–∏—á–∞–π–Ω—É –ª—é–¥–∏–Ω—É, —è–∫–∞ –≤–∏–ø–∞–¥–∫–æ–≤–æ –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ –∞–±—Å—É—Ä–¥–Ω—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó —Ç–∞ –ø–µ—Ä–µ–∂–∏–≤–∞—î –±–∞–≥–∞—Ç–æ –µ–º–æ—Ü—ñ–π.", correct: false },
                        { text: "–ì–µ—Ä–æ—ó—á–Ω–∞ —Ç—Ä–∞–≥–µ–¥—ñ—è –ø—Ä–æ –¥–∞–≤–Ω—å–æ—Ä–∏–º—Å—å–∫–æ–≥–æ –ø–æ–ª–∫–æ–≤–æ–¥—Ü—è, —è–∫–∏–π –±–æ—Ä–µ—Ç—å—Å—è –∑ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–º –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–æ–º –º—ñ–∂ –æ–±–æ–≤'—è–∑–∫–æ–º —ñ –ø–æ—á—É—Ç—Ç—è–º–∏, –¥–æ—Ç—Ä–∏–º—É—é—á–∏—Å—å —î–¥–Ω–æ—Å—Ç—ñ –º—ñ—Å—Ü—è, —á–∞—Å—É —Ç–∞ –¥—ñ—ó.", correct: true },
                        { text: "–§–∞–Ω—Ç–∞—Å—Ç–∏—á–Ω–∞ –ø—Ä–∏–≥–æ–¥–∞ –∑ –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–º–∏ –ø–æ–≤–æ—Ä–æ—Ç–∞–º–∏ —Å—é–∂–µ—Ç—É —Ç–∞ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏ –º—ñ—Å—Ç–∏–∫–∏.", correct: false }
                    ],
                    topic: "—Å—é–∂–µ—Ç –∫–ª–∞—Å–∏—Ü–∏—Å—Ç–∏—á–Ω–æ—ó –ø'—î—Å–∏"
                },
                {
                    scenario: "–í–∏ –ø—Ä–æ–µ–∫—Ç—É—î—Ç–µ –±—É–¥—ñ–≤–ª—é. –Ø–∫–∏–π –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç –≤–∏ –æ–±–µ—Ä–µ—Ç–µ, —â–æ–± –≤–æ–Ω–∞ –≤–∏–≥–ª—è–¥–∞–ª–∞ –∫–ª–∞—Å–∏—á–Ω–æ—é?",
                    answers: [
                        { text: "–ê—Å–∏–º–µ—Ç—Ä–∏—á–Ω—ñ —Ñ–æ—Ä–º–∏ —Ç–∞ –ø–∏—à–Ω—ñ, —Ö–∞–æ—Ç–∏—á–Ω—ñ –ø—Ä–∏–∫—Ä–∞—Å–∏.", correct: false },
                        { text: "–ß—ñ—Ç–∫—ñ, –ø—Ä—è–º—ñ –ª—ñ–Ω—ñ—ó, —Å–∏–º–µ—Ç—Ä–∏—á–Ω—ñ —Ñ–∞—Å–∞–¥–∏ —Ç–∞ –∫–æ–ª–æ–Ω–∏, —â–æ –Ω–∞–≥–∞–¥—É—é—Ç—å –¥–∞–≤–Ω—å–æ–≥—Ä–µ—Ü—å–∫—ñ —Ö—Ä–∞–º–∏.", correct: true },
                        { text: "–Ø—Å–∫—Ä–∞–≤—ñ, –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ñ –∫–æ–ª—å–æ—Ä–∏ —Ç–∞ —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–Ω—ñ, –Ω–µ–∑–≤–∏—á–∞–π–Ω—ñ —Ñ–æ—Ä–º–∏.", correct: false }
                    ],
                    topic: "–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å–∏—Ü–∏–∑–º—É"
                },
                {
                    scenario: "–í–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ –ø–æ—Ä—Ç—Ä–µ—Ç. –Ø–∫–∏–π —Å—Ç–∏–ª—å –±—É–¥–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –∫–ª–∞—Å–∏—Ü–∏–∑–º—É?",
                    answers: [
                        { text: "–ü–æ—Ä—Ç—Ä–µ—Ç, —â–æ –ø–µ—Ä–µ–¥–∞—î —Å–∏–ª—å–Ω—ñ, –¥—Ä–∞–º–∞—Ç–∏—á–Ω—ñ –µ–º–æ—Ü—ñ—ó —Ç–∞ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π —Ä—É—Ö.", correct: false },
                        { text: "–ü–æ—Ä—Ç—Ä–µ—Ç, —â–æ —ñ–¥–µ–∞–ª—ñ–∑—É—î –ª—é–¥–∏–Ω—É, –ø–æ–∫–∞–∑—É—é—á–∏ —ó—ó —Å–ø–æ–∫—ñ–π–Ω–æ—é, —Ä–æ–∑—É–º–Ω–æ—é, –∑ –≤–∏—Ç–æ–Ω—á–µ–Ω–∏–º–∏ —Ä–∏—Å–∞–º–∏, –±–µ–∑ –∑–∞–π–≤–∏—Ö –µ–º–æ—Ü—ñ–π.", correct: true },
                        { text: "–ü–æ—Ä—Ç—Ä–µ—Ç, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —è—Å–∫—Ä–∞–≤—ñ, —Ä–æ–∑–º–∏—Ç—ñ –º–∞–∑–∫–∏, –ø–µ—Ä–µ–¥–∞—é—á–∏ –º–∏—Ç—Ç—î–≤–µ –≤—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞ –≥—Ä—É —Å–≤—ñ—Ç–ª–∞.", correct: false }
                    ],
                    topic: "–∂–∏–≤–æ–ø–∏—Å –∫–ª–∞—Å–∏—Ü–∏–∑–º—É"
                },
                {
                    scenario: "–í–∏ –ø–∏—à–µ—Ç–µ –≤—ñ—Ä—à. –Ø–∫—ñ –ø—Ä–∞–≤–∏–ª–∞ –≤–∏ –±—É–¥–µ—Ç–µ —Å—É–≤–æ—Ä–æ –¥–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—è?",
                    answers: [
                        { text: "–í—ñ–ª—å–Ω–∏–π –≤—ñ—Ä—à –±–µ–∑ —Ä–∏–º–∏ —Ç–∞ —á—ñ—Ç–∫–æ–≥–æ —Ä–∏—Ç–º—É, —â–æ –ø–µ—Ä–µ–¥–∞—î –ø–æ—Ç—ñ–∫ —Å–≤—ñ–¥–æ–º–æ—Å—Ç—ñ.", correct: false },
                        { text: "–°—É–≤–æ—Ä–∏–π —Ä–æ–∑–º—ñ—Ä, —Ä–∏–º–∞, —á—ñ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–∏—Å–æ–∫–æ–≥–æ —Å—Ç–∏–ª—é —Ç–∞ –º—ñ—Ñ–æ–ª–æ–≥—ñ—á–Ω–∏—Ö –æ–±—Ä–∞–∑—ñ–≤.", correct: true },
                        { text: "–ï–º–æ—Ü—ñ–π–Ω—ñ, —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ñ —Ä—è–¥–∫–∏, —â–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å –æ—Å–æ–±–∏—Å—Ç—ñ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ—á—É—Ç—Ç—è, –±–µ–∑ –æ—Å–æ–±–ª–∏–≤–∏—Ö –ø—Ä–∞–≤–∏–ª.", correct: false }
                    ],
                    topic: "–ø–æ–µ–∑—ñ—è –∫–ª–∞—Å–∏—Ü–∏–∑–º—É"
                },
                {
                    scenario: "–í–∏ –æ–±–∏—Ä–∞—î—Ç–µ —Ç–µ–º—É –¥–ª—è –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–≥–æ —Ç–≤–æ—Ä—É. –©–æ –±—É–¥–µ –Ω–∞–π–±—ñ–ª—å—à '–∫–ª–∞—Å–∏—á–Ω–∏–º' –≤–∏–±–æ—Ä–æ–º?",
                    answers: [
                        { text: "–ù–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ –ø—Ä–∏–≥–æ–¥–∏ –∑–≤–∏—á–∞–π–Ω–∏—Ö –ª—é–¥–µ–π —É –ø–æ–≤—Å—è–∫–¥–µ–Ω–Ω–æ–º—É –∂–∏—Ç—Ç—ñ.", correct: false },
                        { text: "–Ü—Å—Ç–æ—Ä—ñ—ó –∑ –∞–Ω—Ç–∏—á–Ω–æ—ó –º—ñ—Ñ–æ–ª–æ–≥—ñ—ó –∞–±–æ –¥–∞–≤–Ω—å–æ—ó —ñ—Å—Ç–æ—Ä—ñ—ó, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—é—Ç—å –±–æ—Ä–æ—Ç—å–±—É —Ä–æ–∑—É–º—É –∑ –ø—Ä–∏—Å—Ç—Ä–∞—Å—Ç—è–º–∏, –∞–±–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç –æ–±–æ–≤'—è–∑–∫—É —Ç–∞ –ø–æ—á—É—Ç—Ç—ñ–≤.", correct: true },
                        { text: "–¢–∞—î–º–Ω–∏—á—ñ –ø–æ–¥—ñ—ó, —â–æ –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –≤ –≥–æ—Ç–∏—á–Ω–∏—Ö –∑–∞–º–∫–∞—Ö, –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ —Å—Ç—Ä–∞—Ö —Ç–∞ –Ω–µ–∑—Ä–æ–∑—É–º—ñ–ª–µ.", correct: false }
                    ],
                    topic: "—Ç–µ–º–∏ –≤ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä—ñ –∫–ª–∞—Å–∏—Ü–∏–∑–º—É"
                }
            ];

            const introScreen = document.getElementById('intro-screen');
            const quizScreen = document.getElementById('quiz-screen');
            const resultsScreen = document.getElementById('results-screen');
            
            const startGameBtn = document.getElementById('start-game-btn');
            const restartGameBtn = document.getElementById('restart-game-btn');
            const nextQuestionBtn = document.getElementById('next-question-btn');
            
            const questionCountDisplay = document.getElementById('question-count');
            const scoreDisplay = document.getElementById('score-display');
            const progressBarFill = document.getElementById('progress-bar-fill');
            const questionText = document.getElementById('question-text');
            const answersContainer = document.getElementById('answers-container');
            const feedbackMessage = document.getElementById('feedback-message');
            const llmExplanationDiv = document.getElementById('llm-explanation');
            const finalScoreDisplay = document.getElementById('final-score');
            const resultMessage = document.getElementById('result-message');

            let currentQuestionIndex = 0;
            let score = 0;

            // Event Listeners
            startGameBtn.addEventListener('click', startGame);
            nextQuestionBtn.addEventListener('click', showNextQuestion);
            restartGameBtn.addEventListener('click', startGame);

            function startGame() {
                introScreen.classList.add('hidden');
                resultsScreen.classList.add('hidden');
                quizScreen.classList.remove('hidden');

                currentQuestionIndex = 0;
                score = 0;
                updateScoreDisplay();
                loadQuestion();
            }

            function loadQuestion() {
                resetQuestionState();
                const q = questions[currentQuestionIndex];
                questionText.textContent = q.scenario; // Display scenario as question
                answersContainer.innerHTML = ''; // Clear previous answers

                // Shuffle answers to make it less predictable
                const shuffledAnswers = [...q.answers].sort(() => Math.random() - 0.5);

                shuffledAnswers.forEach(answer => {
                    const button = document.createElement('button');
                    button.textContent = answer.text;
                    button.classList.add('answer-option', 'w-full', 'block');
                    button.dataset.correct = answer.correct; // Store boolean as string

                    button.addEventListener('click', () => handleAnswerClick(button, answer.correct, q.topic, answer.text, q.answers.find(a => a.correct).text));
                    answersContainer.appendChild(button);
                });

                updateProgress();
            }

            function handleAnswerClick(selectedButton, isCorrect, topic, userAnswerText, correctAnswerText) {
                // Disable all answer buttons after selection
                Array.from(answersContainer.children).forEach(btn => btn.disabled = true);
                
                if (isCorrect) {
                    selectedButton.classList.add('correct');
                    feedbackMessage.textContent = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! ‚úÖ –¢–∏ –æ–±—Ä–∞–≤ –¥–æ—Å–∫–æ–Ω–∞–ª—ñ—Å—Ç—å!';
                    feedbackMessage.classList.add('correct'); // Add correct class for styling
                    score++;
                    generateLlmExplanation(topic, "correct", userAnswerText, correctAnswerText);
                } else {
                    selectedButton.classList.add('incorrect');
                    feedbackMessage.textContent = `–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚ùå. –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: "${correctAnswerText}".`;
                    feedbackMessage.classList.remove('correct'); // Remove correct class if it was there
                    // Highlight correct answer if user was wrong
                    Array.from(answersContainer.children).forEach(btn => {
                        if (btn.dataset.correct === 'true') {
                            btn.classList.add('correct');
                        }
                    });
                    generateLlmExplanation(topic, "incorrect", userAnswerText, correctAnswerText);
                }
                feedbackMessage.classList.remove('hidden');
                nextQuestionBtn.classList.remove('hidden');
                updateScoreDisplay();
            }

            function showNextQuestion() {
                currentQuestionIndex++;
                if (currentQuestionIndex < questions.length) {
                    loadQuestion();
                } else {
                    showResults();
                }
            }

            function resetQuestionState() {
                feedbackMessage.classList.add('hidden');
                feedbackMessage.textContent = '';
                nextQuestionBtn.classList.add('hidden');
                llmExplanationDiv.classList.add('hidden');
                llmExplanationDiv.innerHTML = '';
            }

            function updateScoreDisplay() {
                scoreDisplay.textContent = `‚ú® ${score}`;
            }

            function updateProgress() {
                questionCountDisplay.textContent = `–ü–∏—Ç–∞–Ω–Ω—è ${currentQuestionIndex + 1}/${questions.length}`;
                const progressPercentage = (currentQuestionIndex / questions.length) * 100;
                progressBarFill.style.width = `${progressPercentage}%`;
            }

            function showResults() {
                quizScreen.classList.add('hidden');
                resultsScreen.classList.remove('hidden');
                progressBarFill.style.width = '100%'; // Ensure progress bar is full
                
                finalScoreDisplay.textContent = `${score}/${questions.length}`;

                let message = '';
                const percentage = (score / questions.length) * 100;
                if (percentage === 100) {
                    message = "–ù–µ–π–º–æ–≤—ñ—Ä–Ω–æ! –¢–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –ú–∞–π—Å—Ç–µ—Ä –ö–ª–∞—Å–∏—Ü–∏–∑–º—É! ü§©";
                    finalScoreDisplay.classList.add('text-emerald-600');
                    finalScoreDisplay.classList.remove('text-amber-600', 'text-red-500');
                } else if (percentage >= 60) {
                    message = "–ú–æ–ª–æ–¥–µ—Ü—å! –¢–∏ —á—É–¥–æ–≤–æ —Ä–æ–∑—É–º—ñ—î—à –ø—Ä–∞–≤–∏–ª–∞ –ö–ª–∞—Å–∏—Ü–∏–∑–º—É. –ü—Ä–æ–¥–æ–≤–∂—É–π —É —Ç–æ–º—É –∂ –¥—É—Å—ñ! üëç";
                    finalScoreDisplay.classList.add('text-amber-600');
                    finalScoreDisplay.classList.remove('text-emerald-600', 'text-red-500');
                } else {
                    message = "–ù–µ –∑–∞—Å–º—É—á—É–π—Å—è! –ö–ª–∞—Å–∏—Ü–∏–∑–º –º–∞—î —Å–≤–æ—ó —Å—É–≤–æ—Ä—ñ –ø—Ä–∞–≤–∏–ª–∞, –∞–ª–µ —Ç–∏ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —à–ª—è—Ö—É. –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑, —ñ –≤—Å–µ –≤–∏–π–¥–µ! üí™";
                    finalScoreDisplay.classList.add('text-red-500');
                    finalScoreDisplay.classList.remove('text-emerald-600', 'text-amber-600');
                }
                resultMessage.textContent = message;
            }

            async function generateLlmExplanation(topic, userAnswerStatus, userAnswerText, correctAnswerText) {
                llmExplanationDiv.innerHTML = '<p class="text-center text-stone-500">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—è—Å–Ω–µ–Ω–Ω—è –≤—ñ–¥ –®–Ü...</p>';
                llmExplanationDiv.classList.remove('hidden');

                let prompt = `–ü–æ—è—Å–Ω–∏ –ø—Ä–æ—Å—Ç–æ—é —ñ –¥–æ—Å—Ç—É–ø–Ω–æ—é –º–æ–≤–æ—é, —â–æ —Ç–∞–∫–µ "${topic}" —É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –ö–ª–∞—Å–∏—Ü–∏–∑–º—É. `;
                if (userAnswerStatus === "correct") {
                    prompt += `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–ø–æ–≤—ñ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –æ–±—Ä–∞–≤—à–∏ "${userAnswerText}". –ü–æ—è—Å–Ω–∏, —á–æ–º—É —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —ñ –¥–æ–¥–∞–π —Ç—Ä–æ—Ö–∏ —Ü—ñ–∫–∞–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø–æ —Ç–µ–º—ñ.`;
                } else {
                    prompt += `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–ø–æ–≤—ñ–≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –æ–±—Ä–∞–≤—à–∏ "${userAnswerText}". –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: "${correctAnswerText}". –ü–æ—è—Å–Ω–∏, —á–æ–º—É –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —î —Ç–∞–∫–æ—é, —ñ —Ä–æ–∑–∫—Ä–∏–π —Ç–µ–º—É, —â–æ–± –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—é –∫—Ä–∞—â–µ.`;
                }

                try {
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const apiKey = ""; // Canvas will automatically provide the API key
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error("Gemini API returned an error:", response.status, errorText);
                        llmExplanationDiv.innerHTML = `<p class="text-red-500">–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥ Gemini API: ${response.status}. –î–µ—Ç–∞–ª—ñ: ${errorText.substring(0, 100)}...</p>`;
                        return;
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        llmExplanationDiv.innerHTML = `<h4 class="font-semibold text-emerald-800 mb-2">‚ú® –ü–æ—è—Å–Ω–µ–Ω–Ω—è –≤—ñ–¥ –®–Ü:</h4><p class="text-emerald-700">${text}</p>`;
                    } else {
                        llmExplanationDiv.innerHTML = '<p class="text-red-500">–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—è—Å–Ω–µ–Ω–Ω—è –≤—ñ–¥ –®–Ü. –ù–µ–æ—á—ñ–∫—É–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.</p>';
                    }
                } catch (error) {
                    console.error("Error calling Gemini API:", error);
                    llmExplanationDiv.innerHTML = '<p class="text-red-500">–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—è—Å–Ω–µ–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∞–±–æ —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.</p>';
                }
            }
        });
    </script>
</body>
</html>
