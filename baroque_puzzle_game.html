import React, { useState, useEffect } from 'react';

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–¥–Ω—ñ—î—ó –∫–∞—Ä—Ç–∫–∏
const Card = ({ content, isFlipped, isMatched, onClick }) => {
    return (
        <div
            className={`
                relative w-full h-32 sm:h-40 md:h-48 rounded-lg shadow-md
                flex items-center justify-center cursor-pointer transition-all duration-300 transform
                ${isMatched ? 'opacity-0 scale-90' : 'opacity-100 scale-100'}
                ${isFlipped ? 'rotate-y-180' : ''} /* –¶–µ–π –∫–ª–∞—Å –∫–µ—Ä—É—î –ø–µ—Ä–µ–≤–µ—Ä—Ç–∞–Ω–Ω—è–º —É—Å—ñ—î—ó –∫–∞—Ä—Ç–∫–∏ */
            `}
            onClick={onClick}
            style={{ perspective: '1000px' }} /* –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞ –¥–ª—è 3D-–µ—Ñ–µ–∫—Ç—É –ø–µ—Ä–µ–≤–µ—Ä—Ç–∞–Ω–Ω—è */
        >
            {/* –õ–∏—Ü—å–æ–≤–∞ —Å—Ç–æ—Ä–æ–Ω–∞ –∫–∞—Ä—Ç–∫–∏ (—Å–æ—Ä–æ—á–∫–∞) */}
            <div className="absolute w-full h-full backface-hidden bg-amber-200 rounded-lg flex items-center justify-center text-2xl font-bold text-amber-900 p-4">
                <span className="text-5xl">üèõÔ∏è</span>
            </div>
            {/* –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞ –∫–∞—Ä—Ç–∫–∏ (–∑–º—ñ—Å—Ç) */}
            <div className="absolute w-full h-full backface-hidden bg-white rounded-lg flex items-center justify-center text-center p-4 transform rotate-y-180">
                {/* –ö–ª–∞—Å 'rotate-y-180' —Ç—É—Ç —Ä–æ–±–∏—Ç—å –∑–≤–æ—Ä–æ—Ç–Ω—É —Å—Ç–æ—Ä–æ–Ω—É —Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ—é, –∞ 'backface-hidden' –ø—Ä–∏—Ö–æ–≤—É—î —ó—ó, –∫–æ–ª–∏ –≤–æ–Ω–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∞ —Å–ø–∏–Ω–æ—é –¥–æ –≥–ª—è–¥–∞—á–∞ */}
                <p className="text-sm sm:text-base md:text-lg font-semibold text-stone-700">{content}</p>
            </div>
        </div>
    );
};

// –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≥—Ä–∏
const App = () => {
    const [cards, setCards] = useState([]);
    const [flippedCards, setFlippedCards] = useState([]);
    const [matchedPairs, setMatchedPairs] = useState(0);
    const [moves, setMoves] = useState(0);
    const [gameStarted, setGameStarted] = useState(false);
    const [gameWon, setGameWon] = useState(false);

    // –î–∞–Ω—ñ –¥–ª—è –ø–∞–∑–ª—É (–ø–∞—Ä–∏ "—Ç–µ—Ä–º—ñ–Ω" - "–æ–ø–∏—Å")
    const initialPairs = [
        { id: 1, term: "–ë–∞—Ä–æ–∫–æ", description: "–°—Ç–∏–ª—å XVII-XVIII —Å—Ç., '–ø–µ—Ä–ª–∏–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ñ–æ—Ä–º–∏'" },
        { id: 2, term: "–ü–µ–¥—Ä–æ –ö–∞–ª—å–¥–µ—Ä–æ–Ω", description: "–ê–≤—Ç–æ—Ä –ø'—î—Å–∏ '–ñ–∏—Ç—Ç—è —î —Å–æ–Ω'" },
        { id: 3, term: "–ì—Ä–∏–≥–æ—Ä—ñ–π –°–∫–æ–≤–æ—Ä–æ–¥–∞", description: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π —Ñ—ñ–ª–æ—Å–æ—Ñ, –∞–≤—Ç–æ—Ä '–°–∞–¥—É –±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∏—Ö –ø—ñ—Å–µ–Ω—å'" },
        { id: 4, term: "–ñ–∏—Ç—Ç—è —î —Å–æ–Ω", description: "–ü'—î—Å–∞ –ø—Ä–æ —ñ–ª—é–∑–æ—Ä–Ω—ñ—Å—Ç—å –∂–∏—Ç—Ç—è" },
        { id: 5, term: "–°—Ä–æ–¥–Ω–∞ –ø—Ä–∞—Ü—è", description: "–Ü–¥–µ—è –°–∫–æ–≤–æ—Ä–æ–¥–∏: –∑–∞–π–º–∞—Ç–∏—Å—è —Ç–∏–º, –¥–æ —á–æ–≥–æ —î —Å—Ö–∏–ª—å–Ω—ñ—Å—Ç—å" },
        { id: 6, term: "–ö–æ–Ω—Ç—Ä–∞—Å—Ç–∏", description: "–ü—Ä–æ—Ç–∏—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —Å–≤—ñ—Ç–ª–∞/—Ç—ñ–Ω—ñ, –∂–∏—Ç—Ç—è/—Å–º–µ—Ä—Ç—ñ" },
    ];

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –ø–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫
    const initializeGame = () => {
        const gameCards = [];
        initialPairs.forEach(pair => {
            // –î–æ–¥–∞—î–º–æ –∫–∞—Ä—Ç–∫—É –∑ —Ç–µ—Ä–º—ñ–Ω–æ–º
            gameCards.push({
                id: `${pair.id}-term`,
                pairId: pair.id,
                content: pair.term,
                isFlipped: false,
                isMatched: false,
            });
            // –î–æ–¥–∞—î–º–æ –∫–∞—Ä—Ç–∫—É –∑ –æ–ø–∏—Å–æ–º
            gameCards.push({
                id: `${pair.id}-desc`,
                pairId: pair.id,
                content: pair.description,
                isFlipped: false,
                isMatched: false,
            });
        });

        // –ü–µ—Ä–µ–º—ñ—à—É—î–º–æ –∫–∞—Ä—Ç–∫–∏
        const shuffledCards = gameCards.sort(() => Math.random() - 0.5);
        setCards(shuffledCards);
        setFlippedCards([]);
        setMatchedPairs(0);
        setMoves(0);
        setGameWon(false);
        setGameStarted(true);
    };

    // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –ø–æ –∫–∞—Ä—Ç—Ü—ñ
    const handleCardClick = (clickedCard) => {
        if (!gameStarted || clickedCard.isFlipped || clickedCard.isMatched || flippedCards.length === 2) {
            return; // –Ü–≥–Ω–æ—Ä—É—î–º–æ –∫–ª—ñ–∫–∏, —è–∫—â–æ –≥—Ä–∞ –Ω–µ –ø–æ—á–∞–ª–∞—Å—è, –∫–∞—Ä—Ç–∫–∞ –≤–∂–µ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞/–∑–Ω–∞–π–¥–µ–Ω–∞, –∞–±–æ –≤–∂–µ –¥–≤—ñ –∫–∞—Ä—Ç–∫–∏ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—ñ
        }

        // –ü–µ—Ä–µ–≤–µ—Ä—Ç–∞—î–º–æ –∫–∞—Ä—Ç–∫—É
        const newCards = cards.map(card =>
            card.id === clickedCard.id ? { ...card, isFlipped: true } : card
        );
        setCards(newCards);
        setFlippedCards(prev => [...prev, clickedCard]);
    };

    // –ï—Ñ–µ–∫—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–±—ñ–≥—ñ–≤, –∫–æ–ª–∏ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ –¥–≤—ñ –∫–∞—Ä—Ç–∫–∏
    useEffect(() => {
        if (flippedCards.length === 2) {
            setMoves(prev => prev + 1); // –ó–±—ñ–ª—å—à—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ö–æ–¥—ñ–≤
            const [card1, card2] = flippedCards;

            if (card1.pairId === card2.pairId) {
                // –ó–±—ñ–≥! –ü–æ–∑–Ω–∞—á–∞—î–º–æ —è–∫ –∑–Ω–∞–π–¥–µ–Ω—ñ
                const newCards = cards.map(card =>
                    card.pairId === card1.pairId ? { ...card, isMatched: true } : card
                );
                setCards(newCards);
                setMatchedPairs(prev => prev + 1);
                setFlippedCards([]); // –û—á–∏—â–∞—î–º–æ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—ñ –∫–∞—Ä—Ç–∫–∏
            } else {
                // –ù–µ –∑–±—ñ–≥. –ü–µ—Ä–µ–≤–µ—Ä—Ç–∞—î–º–æ –Ω–∞–∑–∞–¥ —á–µ—Ä–µ–∑ –¥–µ—è–∫–∏–π —á–∞—Å
                setTimeout(() => {
                    const newCards = cards.map(card =>
                        card.id === card1.id || card.id === card2.id ? { ...card, isFlipped: false } : card
                    );
                    setCards(newCards);
                    setFlippedCards([]);
                }, 1000);
            }
        }
    }, [flippedCards, cards]);

    // –ï—Ñ–µ–∫—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–µ—Ä–µ–º–æ–≥–∏
    useEffect(() => {
        if (matchedPairs === initialPairs.length && gameStarted) {
            setGameWon(true);
            setGameStarted(false); // –ó–∞–≤–µ—Ä—à—É—î–º–æ –≥—Ä—É
        }
    }, [matchedPairs, initialPairs.length, gameStarted]);

    return (
        <div className="flex flex-col items-center min-h-screen p-4 sm:p-6 lg:p-8 bg-amber-50">
            <div className="w-full max-w-4xl mx-auto">
                <header className="text-center mb-10">
                    <h1 className="text-4xl sm:text-5xl font-bold text-amber-800 leading-tight">
                        –ü–∞–∑–ª –ë–∞—Ä–æ–∫–æ: –ó–Ω–∞–π–¥–∏ –ü–∞—Ä—É! üß©
                    </h1>
                    <p className="text-lg text-stone-600 mt-2">
                        –ü–µ—Ä–µ–≤—ñ—Ä —Å–≤–æ—ó –∑–Ω–∞–Ω–Ω—è –ø—Ä–æ –Ñ–≤—Ä–æ–ø–µ–π—Å—å–∫–µ –ë–∞—Ä–æ–∫–æ! –ó–Ω–∞–π–¥–∏ –≤—Å—ñ –ø–∞—Ä–∏!
                    </p>
                </header>

                <main className="game-container bg-white rounded-xl shadow-lg p-6 sm:p-8">
                    {!gameStarted && !gameWon && (
                        <div className="text-center">
                            <h2 className="text-2xl font-bold text-stone-800 mb-4">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –≥—Ä–∏!</h2>
                            <p className="text-stone-700 mb-6">
                                –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–æ—á–∞—Ç–∏ –≥—Ä—É", —â–æ–± –∑–Ω–∞–π—Ç–∏ –ø–∞—Ä–∏ —Ç–µ—Ä–º—ñ–Ω—ñ–≤ —Ç–∞ —ó—Ö–Ω—ñ—Ö –æ–ø–∏—Å—ñ–≤, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ –µ–ø–æ—Ö–æ—é –ë–∞—Ä–æ–∫–æ.
                            </p>
                            <button
                                onClick={initializeGame}
                                className="bg-emerald-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-emerald-700 transition-colors duration-300 shadow-md"
                            >
                                –ü–æ—á–∞—Ç–∏ –≥—Ä—É!
                            </button>
                        </div>
                    )}

                    {gameStarted && !gameWon && (
                        <>
                            <div className="flex justify-between items-center mb-6 text-xl font-semibold text-stone-700">
                                <span>–•–æ–¥—ñ–≤: {moves}</span>
                                <span>–ó–Ω–∞–π–¥–µ–Ω–æ –ø–∞—Ä: {matchedPairs} / {initialPairs.length}</span>
                            </div>
                            <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-4 lg:grid-cols-4 gap-4 sm:gap-6">
                                {cards.map(card => (
                                    <Card
                                        key={card.id}
                                        content={card.content}
                                        isFlipped={card.isFlipped}
                                        isMatched={card.isMatched}
                                        onClick={() => handleCardClick(card)}
                                    />
                                ))}
                            </div>
                        </>
                    )}

                    {gameWon && (
                        <div className="text-center">
                            <h2 className="text-3xl sm:text-4xl font-bold text-emerald-600 mb-4">–í—ñ—Ç–∞—î–º–æ! –¢–∏ –ø–µ—Ä–µ–º—ñ–≥! üéâ</h2>
                            <p className="text-xl text-stone-700 mb-6">
                                –¢–∏ –∑–Ω–∞–π—à–æ–≤ —É—Å—ñ {initialPairs.length} –ø–∞—Ä–∏ –∑–∞ {moves} —Ö–æ–¥—ñ–≤!
                            </p>
                            <button
                                onClick={initializeGame}
                                className="bg-amber-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-700 transition-colors duration-300 shadow-md"
                            >
                                –ó—ñ–≥—Ä–∞—Ç–∏ —â–µ —Ä–∞–∑!
                            </button>
                        </div>
                    )}
                </main>

                <footer className="text-center mt-12 text-stone-500 text-sm">
                    <p>&copy; 2025 –í–∞—à –±–ª–æ–≥ "–°–ª–æ–≤–æ –Ω–∞ –¥–æ–ª–æ–Ω—ñ". –ù–∞—Ç—Ö–Ω–µ–Ω–æ –≤–µ–ª–∏—á—á—é –ë–∞—Ä–æ–∫–æ.</p>
                </footer>
            </div>
        </div>
    );
};

export default App;
